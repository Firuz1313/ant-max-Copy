# TV Interface Constructor - Complete Integration

## Обзор реализации

Создана полная интеграция конструктора TV интерфейсов в систему диагностики ТВ-приставок с возможностью создания интерфейсов, отображения их на диагностических страницах и управления областями координат.

## Компоненты и функциональность

### 1. Конструктор TV интерфейсов (`TVInterfaceBuilder.tsx`)

**Основная функциональность:**
- ✅ Создание новых интерфейсов с полями:
  - Название интерфейса
  - Тип интерфейса (home, settings, channels, apps, guide, no-signal, error, custom)
  - Выбор приставки из списка устройств
  - Описание
  - Загрузка скриншота интерфейса
- ✅ Редактирование существующих интерфейсов
- ✅ Активация/деактивация интерфейсов
- ✅ Дублирование интерфейсов
- ✅ Удаление интерфейсов
- ✅ Фильтрация по устройству и типу
- ✅ Поиск по названию

### 2. Редактор областей координат (`TVInterfaceAreaEditor.tsx`)

**Основная функциональность:**
- ✅ Интерактивное рисование областей на скриншоте
- ✅ Два типа областей:
  - **Кликабельные области** - области, по которым можно кликать
  - **Области подсветки** - области для визуального выделения
- ✅ Поддержка форм: прямоугольник и круг
- ✅ Настройка цвета, на��вания и действий для областей
- ✅ Сохранение координат через API
- ✅ Визуальное отображение созданных областей

### 3. Интеграция с управлением шагами (`StepsManager.tsx`)

**Добавленная функциональность:**
- ✅ Выбор созданного TV интерфейса для диагностического шага
- ✅ Отображение доступных интерфейсов для выбранного устройства
- ✅ Кнопка редактирования областей для выбранного интерфейса
- ✅ Автоматическая загрузка интерфейсов при смене устройства
- ✅ Секция отображения всех созданных интерфейсов с предварительным просмотром

### 4. Интеграция с диагностической страницей (`DiagnosticPage.tsx` и `TVDisplay.tsx`)

**Улучшенная функциональность:**
- ✅ Отображение созданных интерфейсов на диагностической странице
- ✅ Поддержка конкретного ID инте��фейса из шага диагностики
- ✅ Отображение областей подсветки и кликабельных областей на интерфейсе
- ✅ Анимация и визуальные эффекты для интерактивных областей
- ✅ Fallback на стандартные интерфейсы при отсутствии созданных

## API и Backend

### 5. TV Interfaces API (`tvInterfacesAPI`)

**Endpoints:**
- ✅ `GET /api/v1/tv-interfaces` - получить все интерфейсы
- ✅ `GET /api/v1/tv-interfaces/:id` - получить интерфейс по ID
- ✅ `GET /api/v1/tv-interfaces/device/:deviceId` - интерфейсы по устройству
- ✅ `POST /api/v1/tv-interfaces` - создать новый интерфейс
- ✅ `PUT /api/v1/tv-interfaces/:id` - обновить интерфейс
- ✅ `DELETE /api/v1/tv-interfaces/:id` - удалить интерфейс
- ✅ `PATCH /api/v1/tv-interfaces/:id/toggle` - переключить статус
- ✅ `POST /api/v1/tv-interfaces/:id/duplicate` - дублировать интерфейс

### 6. Mock Database Support

**Обновления в mockDatabase.js:**
- ✅ Поддержка таблицы tv_interfaces
- ✅ Обработка INSERT/SELECT/UPDATE запросов для TV интерфейсов
- ✅ JOIN с данными устройств
- ✅ Совместимость с string ID устройств

## Типы и интерфейсы

### 7. TypeScript Types (`tvInterface.ts`)

**Определенные типы:**
```typescript
interface TVInterface {
  id: string;
  name: string;
  description?: string;
  type: TVInterfaceType;
  deviceId: string;
  screenshotData?: string;
  clickableAreas?: ClickableArea[];
  highlightAreas?: HighlightArea[];
  isActive: boolean;
  // ... другие поля
}

interface ClickableArea {
  id: string;
  x: number;
  y: number;
  width: number;
  height: number;
  label: string;
  action?: string;
  color?: string;
  shape: 'rectangle' | 'circle';
}

interface HighlightArea {
  id: string;
  x: number;
  y: number;
  width: number;
  height: number;
  label: string;
  color?: string;
  opacity?: number;
  shape: 'rectangle' | 'circle';
}
```

## Рабочий процесс использования

### Создание интерфейса:
1. Переход в админ-панель → TV Interface Builder
2. Создание нового интерфейса с указанием устройства и загрузкой скриншота
3. Сохранение интерфейса в базе данных

### Редактирование областей:
1. Выбор созданного интерфейса
2. Открытие редактора областей
3. Рисование кликабельных и highlight областей
4. Настройка названий, цветов и действий
5. Сохранение координат через API

### Использование в диагностике:
1. Переход в Steps Manager
2. Создание или редактирование шага диагностики
3. Выбор устройства (автоматически загружаются доступные интерфейсы)
4. Выбор конкретного созданного интерфейса
5. Опционально: редактирование областей прямо из Steps Manager

### Отображение в диагностике:
1. Пользователь проходит диагностику
2. На странице диагностики отображается созданный интерфейс
3. Показываются интерактивные области с анимацией
4. Пользователь видит реальный инте��фейс своей приставки

## Связи и интеграция

### Связи между сущностями:
- ✅ **TV Interface ↔ Device**: Каждый интерфейс привязан к конкретному устройству
- ✅ **TV Interface ↔ Diagnostic Step**: Шаги могут использовать созданные интерфейсы
- ✅ **TV Interface ↔ Coordinate Areas**: Интерфейсы содержат кликабельные и highlight области
- ✅ **Diagnostic Step ↔ Remote**: Связь с пультами сохранена и работает параллельно

### Полная персистентность:
- ✅ Все данные сохраняются в базе данных
- ✅ Координаты областей сохраняются как JSON
- ✅ Скриншоты сохраняются как base64 данные
- ✅ Данные не теряются после перезапуска системы

## Функции аналогичные конструктору пульта

### Координатное отображение:
- ✅ Возможность отметить области на скриншоте (как кнопки на пульте)
- ✅ Сохранение координа�� через API
- ✅ Визуальное отображение областей с анимацией
- ✅ Редактирование существующих областей

### Управление в шагах:
- ✅ Интеграция в Steps Manager
- ✅ Выбор интерфейса для каждого шага
- ✅ Кнопка редактирования областей
- ✅ Предварительный просмотр интерфейсов

## Результат

Система теперь предоставляет полную функциональность создания и управления TV интерфейсами:

1. **Конструктор интерфейсов** - создание и управление интерфейсами с скриншотами
2. **Редактор областей** - интерактивное создание кликабельных и highlight областей
3. **Интеграция с диагностикой** - использование созданных интерфейсов в диагностических шагах
4. **Отображение в реальном времени** - показ интерфейсов пользователям во время диагностики
5. **Полная пер��истентность** - все данные сохраняются и восстанавливаются
6. **API интеграция** - полный набор REST API для работы с интерфейсами

Теперь система поддерживает создание интерфейсов для любых ТВ-приставок, их использование в диагностических процедурах, и отображение пользователям для более эффективной диагностики проблем.
